<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Storing data with OpenPMD &mdash; Materials Learning Algorithms (MALA)  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=33f2f6c7" />

  
    <link rel="shortcut icon" href="../_static/mala_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced descriptor options" href="descriptors.html" />
    <link rel="prev" title="Improved training performance" href="trainingmodel.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/mala_horizontal_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage.html">Getting started with MALA</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../advanced_usage.html">Advanced options</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="trainingmodel.html">Improved training performance</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Storing data with OpenPMD</a></li>
<li class="toctree-l2"><a class="reference internal" href="descriptors.html">Advanced descriptor options</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperparameters.html">Improved hyperparameter optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="predictions.html">Using MALA in production</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing MALA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTE.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Materials Learning Algorithms (MALA)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../advanced_usage.html">Advanced options</a></li>
      <li class="breadcrumb-item active">Storing data with OpenPMD</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//mala-project/mala/blob/develop/docs/source/advanced_usage/openpmd.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="storing-data-with-openpmd">
<span id="openpmd-data"></span><h1>Storing data with OpenPMD<a class="headerlink" href="#storing-data-with-openpmd" title="Link to this heading">ÔÉÅ</a></h1>
<p>The current MALA default to save volumetric data are <code class="docutils literal notranslate"><span class="pre">numpy</span></code> objects/files.
However, <code class="docutils literal notranslate"><span class="pre">numpy</span></code> files do not store metadata, which is crucial when
attempting to build large-scale data-driven workflows. Furthermore, they are
inherently non-parallel and do not offer extensive compression capabilities.</p>
<p>To this end, MALA now supports the <a class="reference external" href="https://github.com/openPMD">openPMD</a>
standard. OpenPMD is a powerful standard/library that allows for the efficient
storage of volumetric data alongside relevant metadata, and further offers
capabilities for parallelization and a declarative runtime configuration
for compression options.</p>
<p>Currently, openPMD is tested by the MALA team in production and therefore
not the default option for data handling. Yet, MALA is fully compatible with
openPMD, and its use is highly encouraged. To do so, just replace the
<code class="docutils literal notranslate"><span class="pre">.npy</span></code> file ending with a openPMD compliant file ending (e.g. <code class="docutils literal notranslate"><span class="pre">.h5</span></code>) in
all instances of the <code class="docutils literal notranslate"><span class="pre">DataConverter</span></code>, <code class="docutils literal notranslate"><span class="pre">DataHandler</span></code> and <code class="docutils literal notranslate"><span class="pre">DataShuffler</span></code>
class, and specify <code class="docutils literal notranslate"><span class="pre">openpmd</span></code> where necessary; the workflows themselves can
be left untouched. Specifically, set</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>

<span class="c1"># Changes for DataConverter</span>
<span class="n">data_converter</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">DataConverter</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">data_converter</span><span class="o">.</span><span class="n">convert_snapshots</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
                                 <span class="n">naming_scheme</span><span class="o">=</span><span class="s2">&quot;Be_snapshot*.h5&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="c1"># Changes for DataHandler</span>
<span class="n">data_handler</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">DataHandler</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">data_handler</span><span class="o">.</span><span class="n">add_snapshot</span><span class="p">(</span><span class="s2">&quot;Be_snapshot0.in.h5&quot;</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span>
                           <span class="s2">&quot;Be_snapshot0.out.h5&quot;</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="s2">&quot;tr&quot;</span><span class="p">,</span>
                           <span class="n">snapshot_type</span><span class="o">=</span><span class="s2">&quot;openpmd&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="c1"># Changes for DataShuffler</span>
<span class="n">data_shuffler</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">DataShuffler</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
<span class="c1"># Data can be shuffle FROM and TO openPMD - but also from</span>
<span class="c1"># numpy to openPMD.</span>
<span class="n">data_shuffler</span><span class="o">.</span><span class="n">add_snapshot</span><span class="p">(</span><span class="s2">&quot;Be_snapshot0.in.h5&quot;</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span>
                            <span class="s2">&quot;Be_snapshot0.out.h5&quot;</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span>
                            <span class="n">snapshot_type</span><span class="o">=</span><span class="s2">&quot;openpmd&quot;</span><span class="p">)</span>
<span class="n">data_shuffler</span><span class="o">.</span><span class="n">shuffle_snapshots</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
                                <span class="n">save_name</span><span class="o">=</span><span class="s2">&quot;Be_shuffled*.h5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>For further information on the interaction with openPMD data,
please consult the <a class="reference external" href="https://openpmd-api.readthedocs.io">official documentation</a>.
As a user of MALA, you will be mainly interested in the scientific tooling
that can read openPMD, e.g.:</p>
<ul class="simple">
<li><p>visualization and analysis, including an exploratory Jupyter notebook GUI: <a class="reference external" href="https://github.com/openPMD/openPMD-viewer">openPMD-viewer</a></p></li>
<li><p><a class="reference external" href="http://yt-project.org/doc/examining/loading_data.html#openpmd-data">yt-project</a> (<a class="reference external" href="https://gist.github.com/C0nsultant/5808d5f61b271b8f969d5c09f5ca91dc">tutorial</a>)</p></li>
<li><p><a class="reference external" href="https://www.paraview.org/">ParaView</a> has a Python-based openPMD plugin that can be activated by opening a helper text file ending on <code class="docutils literal notranslate"><span class="pre">.pmd</span></code> that contains one line with the openPMD-api Series filename, e.g. <code class="docutils literal notranslate"><span class="pre">data_%T.bp</span></code></p></li>
<li><p><a class="reference external" href="https://github.com/openPMD/openPMD-visit-plugin">VisIt</a></p></li>
<li><p>converter tools: <a class="reference external" href="https://github.com/openPMD/openPMD-converter">openPMD-converter</a></p></li>
<li><p>full list of <a class="reference external" href="https://github.com/openPMD/openPMD-projects">projects using openPMD</a></p></li>
</ul>
<p>If you intend to write your own post-processing routines, make sure to check out our <a class="reference external" href="https://github.com/openPMD/openPMD-example-datasets">example files</a> and the <a class="reference external" href="https://github.com/openPMD/openPMD-standard">formal, open standard</a> on openPMD.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="trainingmodel.html" class="btn btn-neutral float-left" title="Improved training performance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="descriptors.html" class="btn btn-neutral float-right" title="Advanced descriptor options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software. Attila Cangi, J. Austin Ellis, Lenz Fiedler, Daniel Kotik, Normand Modine, Sivasankaran Rajamanickam, Steve Schmerler, Aidan Thompson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>