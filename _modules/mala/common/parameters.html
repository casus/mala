<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mala.common.parameters &mdash; Materials Learning Algorithms (MALA)  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/mala_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html">
            <img src="../../../_static/mala_horizontal_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTE.html">Contributing to MALA</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Materials Learning Algorithms (MALA)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>mala.common.parameters</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mala.common.parameters</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Collection of all parameter related classes and functions.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">horovod.torch</span> <span class="k">as</span> <span class="nn">hvd</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">mala.common.parallelizer</span> <span class="kn">import</span> <span class="n">printout</span><span class="p">,</span> <span class="n">set_horovod_status</span><span class="p">,</span> \
    <span class="n">set_mpi_status</span><span class="p">,</span> <span class="n">get_rank</span><span class="p">,</span> <span class="n">get_local_rank</span><span class="p">,</span> <span class="n">set_current_verbosity</span><span class="p">,</span> \
    <span class="n">parallel_warn</span>
<span class="kn">from</span> <span class="nn">mala.common.json_serializable</span> <span class="kn">import</span> <span class="n">JSONSerializable</span>


<div class="viewcode-block" id="ParametersBase"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersBase">[docs]</a><span class="k">class</span> <span class="nc">ParametersBase</span><span class="p">(</span><span class="n">JSONSerializable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base parameter class for MALA.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gpu&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;horovod&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;mpi&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                               <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;openpmd_configuration&quot;</span><span class="p">:</span> <span class="p">{},</span>
                               <span class="s2">&quot;openpmd_granularity&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="ParametersBase.show"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersBase.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print name and values of all attributes of this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : string</span>
<span class="sd">            The indent used in the list with which the parameter</span>
<span class="sd">            shows itself.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="s2">&quot;_configuration&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                    <span class="n">printout</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)),</span>
                             <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">printout</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)),</span>
                             <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_gpu</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;gpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_gpu</span>

    <span class="k">def</span> <span class="nf">_update_horovod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_horovod</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;horovod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_horovod</span>

    <span class="k">def</span> <span class="nf">_update_mpi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_mpi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;mpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mpi</span>

    <span class="k">def</span> <span class="nf">_update_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_device</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_device</span>

    <span class="k">def</span> <span class="nf">_update_openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_openpmd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;openpmd_configuration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_openpmd</span>

    <span class="k">def</span> <span class="nf">_update_openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_granularity</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;openpmd_granularity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_granularity</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_member_to_json</span><span class="p">(</span><span class="n">member</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">member</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>

<div class="viewcode-block" id="ParametersBase.to_json"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersBase.to_json">[docs]</a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert this object to a dictionary that can be saved in a JSON file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        json_dict : dict</span>
<span class="sd">            The object as dictionary for export to JSON.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">members</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">isroutine</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="c1"># Filter out all private members, builtins, etc.</span>
            <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>

                <span class="c1"># If we deal with a list or a dict,</span>
                <span class="c1"># we have to sanitize treat all members of that list</span>
                <span class="c1"># or dict separately.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">_member</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">_member</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_member_to_json</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
                        <span class="n">json_dict</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_member</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">json_dict</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">_member</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">_member</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_member_to_json</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">m</span><span class="p">])</span>
                        <span class="n">json_dict</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_member</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">json_dict</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">json_dict</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_member_to_json</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">json_dict</span><span class="p">[</span><span class="s2">&quot;_parameters_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="n">json_dict</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_json_to_member</span><span class="p">(</span><span class="n">json_value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">json_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;object&quot;</span> <span class="ow">in</span> <span class="n">json_value</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># We have found ourselves an object!</span>
                <span class="c1"># We create it and give it the JSON dict, hoping it can handle</span>
                <span class="c1"># it. If not, then the implementation of that class has to</span>
                <span class="c1"># be adjusted.</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;mala&quot;</span><span class="p">)</span>
                <span class="n">class_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">json_value</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span>
                <span class="n">new_object</span> <span class="o">=</span> <span class="n">class_</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_value</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">new_object</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If it is not an elementary builtin type AND not an object</span>
                <span class="c1"># dictionary, something is definitely off.</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Could not decode JSON file, error in&quot;</span><span class="p">,</span>
                                <span class="n">json_value</span><span class="p">)</span>

<div class="viewcode-block" id="ParametersBase.from_json"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersBase.from_json">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read this object from a dictionary saved in a JSON file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        json_dict : dict</span>
<span class="sd">            A dictionary containing all attributes, properties, etc. as saved</span>
<span class="sd">            in the json file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        deserialized_object : JSONSerializable</span>
<span class="sd">            The object as read from the JSON file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deserialized_object</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="p">:</span>
            <span class="c1"># Filter out all private members, builtins, etc.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;_parameters_type&quot;</span><span class="p">:</span>

                <span class="c1"># If we deal with a list or a dict,</span>
                <span class="c1"># we have to sanitize treat all members of that list</span>
                <span class="c1"># or dict separately.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">_member</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="n">_member</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deserialized_object</span><span class="o">.</span>
                                           <span class="n">_json_to_member</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">deserialized_object</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_member</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">deserialized_object</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">_member</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">_member</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">deserialized_object</span><span class="o">.</span>\
                                <span class="n">_json_to_member</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">m</span><span class="p">])</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">deserialized_object</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_member</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">deserialized_object</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">deserialized_object</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">deserialized_object</span><span class="o">.</span>
                            <span class="n">_json_to_member</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">deserialized_object</span></div></div>


<div class="viewcode-block" id="ParametersNetwork"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersNetwork">[docs]</a><span class="k">class</span> <span class="nc">ParametersNetwork</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters necessary for constructing a neural network.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nn_type : string</span>
<span class="sd">        Type of the neural network that will be used. Currently supported are</span>
<span class="sd">            - &quot;feed_forward&quot; (default)</span>
<span class="sd">            - &quot;transformer&quot;</span>
<span class="sd">            - &quot;lstm&quot;</span>
<span class="sd">            - &quot;gru&quot;</span>


<span class="sd">    layer_sizes : list</span>
<span class="sd">        A list of integers detailing the sizes of the layer of the neural</span>
<span class="sd">        network. Please note that the input layer is included therein.</span>
<span class="sd">        Default: [10,10,0]</span>

<span class="sd">    layer_activations: list</span>
<span class="sd">        A list of strings detailing the activation functions to be used</span>
<span class="sd">        by the neural network. If the dimension of layer_activations is</span>
<span class="sd">        smaller than the dimension of layer_sizes-1, than the first entry</span>
<span class="sd">        is used for all layers.</span>
<span class="sd">        Currently supported activation functions are:</span>

<span class="sd">            - Sigmoid (default)</span>
<span class="sd">            - ReLU</span>
<span class="sd">            - LeakyReLU</span>

<span class="sd">    loss_function_type: string</span>
<span class="sd">        Loss function for the neural network</span>
<span class="sd">        Currently supported loss functions include:</span>

<span class="sd">            - mse (Mean squared error; default)</span>
<span class="sd">    no_hidden_state : bool</span>
<span class="sd">        If True hidden and cell state is assigned to zeros for LSTM Network.</span>
<span class="sd">        false will keep the hidden state active</span>
<span class="sd">        Default: False</span>

<span class="sd">    bidirection: bool</span>
<span class="sd">        Sets lstm network size based on bidirectional or just one direction</span>
<span class="sd">        Default: False</span>

<span class="sd">    num_hidden_layers: int</span>
<span class="sd">        Number of hidden layers to be used in lstm or gru or transformer nets</span>
<span class="sd">        Default: None</span>

<span class="sd">    dropout: float</span>
<span class="sd">        Dropout rate for transformer net</span>
<span class="sd">        0.0 ≤ dropout ≤ 1.0</span>
<span class="sd">        Default: 0.0</span>

<span class="sd">    num_heads: int</span>
<span class="sd">        Number of heads to be used in Multi head attention network</span>
<span class="sd">        This should be a divisor of input dimension</span>
<span class="sd">        Default: None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersNetwork</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nn_type</span> <span class="o">=</span> <span class="s2">&quot;feed-forward&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_activations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sigmoid&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loss_function_type</span> <span class="o">=</span> <span class="s2">&quot;mse&quot;</span>

        <span class="c1"># for LSTM/Gru + Transformer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_hidden_layers</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># for LSTM/Gru</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_hidden_state</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bidirection</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># for transformer net</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_heads</span> <span class="o">=</span> <span class="mi">10</span></div>


<div class="viewcode-block" id="ParametersDescriptors"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersDescriptors">[docs]</a><span class="k">class</span> <span class="nc">ParametersDescriptors</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters necessary for calculating/parsing input descriptors.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    descriptor_type : string</span>
<span class="sd">        Type of descriptors that is used to represent the atomic fingerprint.</span>
<span class="sd">        Supported:</span>

<span class="sd">            - &#39;Bispectrum&#39;: Bispectrum descriptors (formerly called &#39;SNAP&#39;).</span>
<span class="sd">            - &#39;Atomic Density&#39;: Atomic density, calculated via Gaussian</span>
<span class="sd">                                descriptors.</span>

<span class="sd">    bispectrum_twojmax : int</span>
<span class="sd">        Bispectrum calculation: 2*jmax-parameter used for calculation of SNAP</span>
<span class="sd">        descriptors. Default value for jmax is 5, so default value for</span>
<span class="sd">        twojmax is 10.</span>

<span class="sd">    lammps_compute_file: string</span>
<span class="sd">        Bispectrum calculation: LAMMPS input file that is used to calculate the</span>
<span class="sd">        Bispectrum descriptors. If this string is empty, the standard LAMMPS input</span>
<span class="sd">        file found in this repository will be used (recommended).</span>

<span class="sd">    descriptors_contain_xyz : bool</span>
<span class="sd">        Legacy option. If True, it is assumed that the first three entries of</span>
<span class="sd">        the descriptor vector are the xyz coordinates and they are cut from the</span>
<span class="sd">        descriptor vector. If False, no such cutting is peformed.</span>

<span class="sd">    atomic_density_sigma : float</span>
<span class="sd">        Sigma used for the calculation of the Gaussian descriptors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersDescriptors</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptor_type</span> <span class="o">=</span> <span class="s2">&quot;Bispectrum&quot;</span>

        <span class="c1"># These affect all descriptors, at least as long all descriptors</span>
        <span class="c1"># use LAMMPS (which they currently do).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lammps_compute_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors_contain_xyz</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># TODO: I would rather handle the parallelization info automatically</span>
        <span class="c1"># and more under the hood. At this stage of the project this would</span>
        <span class="c1"># probably be overkill and hard to do, since there are many moving</span>
        <span class="c1"># parts, so for now let&#39;s keep this here, but in the future,</span>
        <span class="c1"># this should be adressed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_z_splitting</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_y_splitting</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Everything pertaining to the bispectrum descriptors.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bispectrum_twojmax</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bispectrum_cutoff</span> <span class="o">=</span> <span class="mf">4.67637</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bispectrum_switchflag</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Everything pertaining to the atomic density.</span>
        <span class="c1"># Seperate cutoff given here because bispectrum descriptors and</span>
        <span class="c1"># atomic density may be used at the same time, if e.g. bispectrum</span>
        <span class="c1"># descriptors are used for a full inference, which then uses the atomic</span>
        <span class="c1"># density for the calculation of the Ewald sum.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_atomic_density_energy_formula</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomic_density_sigma</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomic_density_cutoff</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_z_splitting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control whether splitting across the z-axis is used.</span>

<span class="sd">        Default is True, since this gives descriptors compatible with</span>
<span class="sd">        QE, for total energy evaluation. However, setting this value to False</span>
<span class="sd">        can, e.g. in the LAMMPS case, improve performance. This is relevant</span>
<span class="sd">        for e.g. preprocessing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_z_splitting</span>

    <span class="nd">@use_z_splitting</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">use_z_splitting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_y_splitting</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_z_splitting</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_y_splitting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control whether a splitting in y-axis is used.</span>

<span class="sd">        This can only be used in conjunction with a z-splitting, and</span>
<span class="sd">        the option will ignored if z-splitting is disabled. Only has an</span>
<span class="sd">        effect for values larger then 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_y_planes</span>

    <span class="nd">@use_y_splitting</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">use_y_splitting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_z_splitting</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_number_y_planes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_number_y_planes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_number_y_planes</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bispectrum_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cut off radius for bispectrum calculation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rcutfac</span>

    <span class="nd">@bispectrum_cutoff</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bispectrum_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rcutfac</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomic_density_cutoff</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bispectrum_switchflag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switchflag for the bispectrum calculation.</span>

<span class="sd">        Can only be 1 or 0. If 1 (default), a switching function will be used</span>
<span class="sd">        to ensure that atomic contributions smoothly go to zero after a</span>
<span class="sd">        certain cutoff. If 0 (old default, which can be problematic in some</span>
<span class="sd">        instances), this is not done, which can lead to discontinuities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snap_switchflag</span>

    <span class="nd">@bispectrum_switchflag</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bispectrum_switchflag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">_int_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_int_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_snap_switchflag</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">_int_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_snap_switchflag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_update_mpi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_mpi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;mpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mpi</span>

        <span class="c1"># There may have been a serial or parallel run before that is now</span>
        <span class="c1"># no longer valid.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lammps_compute_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="ParametersTargets"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersTargets">[docs]</a><span class="k">class</span> <span class="nc">ParametersTargets</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters necessary for calculating/parsing output quantites.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    target_type : string</span>
<span class="sd">        Number of points in the energy grid that is used to calculate the</span>
<span class="sd">        (L)DOS.</span>

<span class="sd">    ldos_gridsize : float</span>
<span class="sd">        Gridsize of the LDOS.</span>

<span class="sd">    ldos_gridspacing_ev: float</span>
<span class="sd">        Gridspacing of the energy grid the (L)DOS is evaluated on [eV].</span>

<span class="sd">    ldos_gridoffset_ev: float</span>
<span class="sd">        Lowest energy value on the (L)DOS energy grid [eV].</span>

<span class="sd">    pseudopotential_path : string</span>
<span class="sd">        Path at which pseudopotentials are located (for TEM).</span>

<span class="sd">    rdf_parameters : dict</span>
<span class="sd">        Parameters for calculating the radial distribution function(RDF).</span>
<span class="sd">        The RDF can directly be calculated via a function call, but if it is</span>
<span class="sd">        calculated e.g. during a MD or MC run, these parameters will control</span>
<span class="sd">        how. The following keywords are recognized:</span>

<span class="sd">        number_of_bins : int</span>
<span class="sd">            Number of bins used to create the histogram.</span>

<span class="sd">        rMax : float</span>
<span class="sd">            Radius up to which to calculate the RDF. None by default; this</span>
<span class="sd">            is the suggested behavior, as MALA will then on its own calculate</span>
<span class="sd">            the maximum radius up until which the calculation of the RDF is</span>
<span class="sd">            indisputably physically meaningful. Larger radii may be specified,</span>
<span class="sd">            e.g. for a Fourier transformation to calculate the static structure</span>
<span class="sd">            factor.</span>

<span class="sd">    tpcf_parameters : dict</span>
<span class="sd">        Parameters for calculating the three particle correlation function</span>
<span class="sd">        (TPCF).</span>
<span class="sd">        The TPCF can directly be calculated via a function call, but if it is</span>
<span class="sd">        calculated e.g. during a MD or MC run, these parameters will control</span>
<span class="sd">        how. The following keywords are recognized:</span>

<span class="sd">        number_of_bins : int</span>
<span class="sd">            Number of bins used to create the histogram.</span>

<span class="sd">        rMax : float</span>
<span class="sd">            Radius up to which to calculate the TPCF. If None, MALA will</span>
<span class="sd">            determine the maximum radius for which the TPCF is indisputably</span>
<span class="sd">            defined. Be advised - this may come at increased computational</span>
<span class="sd">            cost.</span>

<span class="sd">    ssf_parameters : dict</span>
<span class="sd">        Parameters for calculating the static structure factor</span>
<span class="sd">        (SSF).</span>
<span class="sd">        The SSF can directly be calculated via a function call, but if it is</span>
<span class="sd">        calculated e.g. during a MD or MC run, these parameters will control</span>
<span class="sd">        how. The following keywords are recognized:</span>

<span class="sd">        number_of_bins : int</span>
<span class="sd">            Number of bins used to create the histogram.</span>

<span class="sd">        kMax : float</span>
<span class="sd">            Maximum wave vector up to which to calculate the SSF.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersTargets</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_type</span> <span class="o">=</span> <span class="s2">&quot;LDOS&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ldos_gridsize</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ldos_gridspacing_ev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ldos_gridoffset_ev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restrict_targets</span> <span class="o">=</span> <span class="s2">&quot;zero_out_negative&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pseudopotential_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdf_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number_of_bins&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;rMax&quot;</span><span class="p">:</span> <span class="s2">&quot;mic&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpcf_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number_of_bins&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;rMax&quot;</span><span class="p">:</span> <span class="s2">&quot;mic&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssf_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number_of_bins&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;kMax&quot;</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">restrict_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control if and how targets are restricted to physical values.</span>

<span class="sd">        Can be &quot;zero_out_negative&quot;, i.e. all negative values are set to zero</span>
<span class="sd">        or &quot;absolute_values&quot;, i.e. all negative values are multiplied by -1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_restrict_targets</span>

    <span class="nd">@restrict_targets</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">restrict_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;zero_out_negative&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;absolute_values&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restrict_targets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_restrict_targets</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="ParametersData"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersData">[docs]</a><span class="k">class</span> <span class="nc">ParametersData</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters necessary for loading and preprocessing data.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    descriptors_contain_xyz : bool</span>
<span class="sd">        Legacy option. If True, it is assumed that the first three entries of</span>
<span class="sd">        the descriptor vector are the xyz coordinates and they are cut from the</span>
<span class="sd">        descriptor vector. If False, no such cutting is peformed.</span>

<span class="sd">    snapshot_directories_list : list</span>
<span class="sd">        A list of all added snapshots.</span>

<span class="sd">    data_splitting_type : string</span>
<span class="sd">        Specify how the data for validation, test and training is splitted.</span>
<span class="sd">        Currently the only supported option is by_snapshot,</span>
<span class="sd">        which splits the data by snapshot boundaries. It is also the default.</span>

<span class="sd">    input_rescaling_type : string</span>
<span class="sd">        Specifies how input quantities are normalized.</span>
<span class="sd">        Options:</span>

<span class="sd">            - &quot;None&quot;: No normalization is applied.</span>
<span class="sd">            - &quot;standard&quot;: Standardization (Scale to mean 0, standard</span>
<span class="sd">              deviation 1)</span>
<span class="sd">            - &quot;normal&quot;: Min-Max scaling (Scale to be in range 0...1)</span>
<span class="sd">            - &quot;feature-wise-standard&quot;: Row Standardization (Scale to mean 0,</span>
<span class="sd">              standard deviation 1)</span>
<span class="sd">            - &quot;feature-wise-normal&quot;: Row Min-Max scaling (Scale to be in range</span>
<span class="sd">              0...1)</span>

<span class="sd">    output_rescaling_type : string</span>
<span class="sd">        Specifies how output quantities are normalized.</span>
<span class="sd">        Options:</span>

<span class="sd">            - &quot;None&quot;: No normalization is applied.</span>
<span class="sd">            - &quot;standard&quot;: Standardization (Scale to mean 0,</span>
<span class="sd">              standard deviation 1)</span>
<span class="sd">            - &quot;normal&quot;: Min-Max scaling (Scale to be in range 0...1)</span>
<span class="sd">            - &quot;feature-wise-standard&quot;: Row Standardization (Scale to mean 0,</span>
<span class="sd">              standard deviation 1)</span>
<span class="sd">            - &quot;feature-wise-normal&quot;: Row Min-Max scaling (Scale to be in</span>
<span class="sd">              range 0...1)</span>

<span class="sd">    use_lazy_loading : bool</span>
<span class="sd">        If True, data is lazily loaded, i.e. only the snapshots that are</span>
<span class="sd">        currently needed will be kept in memory. This greatly reduces memory</span>
<span class="sd">        demands, but adds additional computational time.</span>

<span class="sd">    use_clustering : bool</span>
<span class="sd">        If True, and use_lazy_loading is True as well, the data is clustered,</span>
<span class="sd">        i.e. not the entire training data is used by rather only a subset</span>
<span class="sd">        which is determined by a clustering algorithm.</span>

<span class="sd">    number_of_clusters : int</span>
<span class="sd">        If use_clustering is True, this is the number of clusters used per</span>
<span class="sd">        snapshot.</span>

<span class="sd">    train_ratio : float</span>
<span class="sd">        If use_clustering is True, this is the ratio of training data used</span>
<span class="sd">        to train the encoder for the clustering.</span>

<span class="sd">    sample_ratio : float</span>
<span class="sd">        If use_clustering is True, this is the ratio of training data used</span>
<span class="sd">        for sampling per snapshot (according to clustering then, of course).</span>

<span class="sd">    use_fast_tensor_data_set : bool</span>
<span class="sd">        If True, then the new, fast TensorDataSet implemented by Josh Romero</span>
<span class="sd">        will be used.</span>

<span class="sd">    shuffling_seed : int</span>
<span class="sd">        If not None, a seed that will be used to make the shuffling of the data</span>
<span class="sd">        in the DataShuffler class deterministic.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersData</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_directories_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_splitting_type</span> <span class="o">=</span> <span class="s2">&quot;by_snapshot&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_rescaling_type</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_rescaling_type</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_lazy_loading</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_clustering</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_clusters</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_ratio</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_ratio</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_fast_tensor_data_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffling_seed</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ParametersRunning"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersRunning">[docs]</a><span class="k">class</span> <span class="nc">ParametersRunning</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters needed for network runs (train, test or inference).</span>

<span class="sd">    Some of these parameters only apply to either the train or test or</span>
<span class="sd">    inference case.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    trainingtype : string</span>
<span class="sd">        Training type to be used. Supported options at the moment:</span>

<span class="sd">            - SGD: Stochastic gradient descent.</span>
<span class="sd">            - Adam: Adam Optimization Algorithm</span>

<span class="sd">    learning_rate : float</span>
<span class="sd">        Learning rate for chosen optimization algorithm. Default: 0.5.</span>

<span class="sd">    max_number_epochs : int</span>
<span class="sd">        Maximum number of epochs to train for. Default: 100.</span>

<span class="sd">    mini_batch_size : int</span>
<span class="sd">        Size of the mini batch for the optimization algorihm. Default: 10.</span>

<span class="sd">    weight_decay : float</span>
<span class="sd">        Weight decay for regularization. Always refers to L2 regularization.</span>
<span class="sd">        Default: 0.</span>

<span class="sd">    early_stopping_epochs : int</span>
<span class="sd">        Number of epochs the validation accuracy is allowed to not improve by</span>
<span class="sd">        at leastearly_stopping_threshold, before we terminate. If 0, no</span>
<span class="sd">        early stopping is performed. Default: 0.</span>

<span class="sd">    early_stopping_threshold : float</span>
<span class="sd">        If the validation accuracy does not improve by at least threshold for</span>
<span class="sd">        early_stopping_epochs epochs, training is terminated:</span>
<span class="sd">        validation_loss &lt; validation_loss_old * (1+early_stopping_threshold),</span>
<span class="sd">        or patience counter will go up.</span>
<span class="sd">        Default: 0. Numbers bigger than 0 can make early stopping very</span>
<span class="sd">        aggresive.</span>

<span class="sd">    learning_rate_scheduler : string</span>
<span class="sd">        Learning rate scheduler to be used. If not None, an instance of the</span>
<span class="sd">        corresponding pytorch class will be used to manage the learning rate</span>
<span class="sd">        schedule.</span>
<span class="sd">        Options:</span>

<span class="sd">            - None: No learning rate schedule will be used.</span>
<span class="sd">            - &quot;ReduceLROnPlateau&quot;: The learning rate will be reduced when the</span>
<span class="sd">              validation loss is plateauing.</span>

<span class="sd">    learning_rate_decay : float</span>
<span class="sd">        Decay rate to be used in the learning rate (if the chosen scheduler</span>
<span class="sd">        supports that).</span>
<span class="sd">        Default: 0.1</span>

<span class="sd">    learning_rate_patience : int</span>
<span class="sd">        Patience parameter used in the learning rate schedule (how long the</span>
<span class="sd">        validation loss has to plateau before the schedule takes effect).</span>
<span class="sd">        Default: 0.</span>

<span class="sd">    use_compression : bool</span>
<span class="sd">        If True and horovod is used, horovod compression will be used for</span>
<span class="sd">        allreduce communication. This can improve performance.</span>

<span class="sd">    num_workers : int</span>
<span class="sd">        Number of workers to be used for data loading.</span>

<span class="sd">    use_shuffling_for_samplers :</span>
<span class="sd">        If True, the training data will be shuffled in between epochs.</span>
<span class="sd">        If lazy loading is selected, then this shuffling will be done on</span>
<span class="sd">        a &quot;by snapshot&quot; basis.</span>

<span class="sd">    checkpoints_each_epoch : int</span>
<span class="sd">        If not 0, checkpoint files will be saved after eac</span>
<span class="sd">        checkpoints_each_epoch epoch.</span>

<span class="sd">    checkpoint_name : string</span>
<span class="sd">        Name used for the checkpoints. Using this, multiple runs</span>
<span class="sd">        can be performed in the same directory.</span>

<span class="sd">    visualisation : int</span>
<span class="sd">        If True then Tensorboard is activated for visualisation</span>
<span class="sd">        case 0: No tensorboard activated</span>
<span class="sd">        case 1: tensorboard activated with Loss and learning rate</span>
<span class="sd">        case 2; additonally weights and biases and gradient</span>

<span class="sd">    visualisation_dir : string</span>
<span class="sd">        Name of the folder that visualization files will be saved to.</span>

<span class="sd">    visualisation_dir_append_date : bool</span>
<span class="sd">        If True, then upon creating visualization files, these will be saved</span>
<span class="sd">        in a subfolder of visualisation_dir labelled with the starting date</span>
<span class="sd">        of the visualization, to avoid having to change input scripts often.</span>

<span class="sd">    inference_data_grid : list</span>
<span class="sd">        List holding the grid to be used for inference in the form of</span>
<span class="sd">        [x,y,z].</span>

<span class="sd">    use_mixed_precision : bool</span>
<span class="sd">        If True, mixed precision computation (via AMP) will be used.</span>

<span class="sd">    training_report_frequency : int</span>
<span class="sd">        Determines how often detailed performance info is printed during</span>
<span class="sd">        training (only has an effect if the verbosity is high enough).</span>

<span class="sd">    profiler_range : list</span>
<span class="sd">        List with two entries determining with which batch/iteration number</span>
<span class="sd">         the CUDA profiler will start and stop profiling. Please note that</span>
<span class="sd">         this option only holds significance if the nsys profiler is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersRunning</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainingtype</span> <span class="o">=</span> <span class="s2">&quot;SGD&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_number_epochs</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mini_batch_size</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight_decay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">early_stopping_epochs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">early_stopping_threshold</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_scheduler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_decay</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate_patience</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_compression</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_shuffling_for_samplers</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_each_epoch</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_name</span> <span class="o">=</span> <span class="s2">&quot;checkpoint_mala&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualisation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualisation_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;mala_logging&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualisation_dir_append_date</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">during_training_metric</span> <span class="o">=</span> <span class="s2">&quot;ldos&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">after_before_training_metric</span> <span class="o">=</span> <span class="s2">&quot;ldos&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inference_data_grid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_mixed_precision</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_graphs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_report_frequency</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiler_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_update_horovod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_horovod</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersRunning</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_update_horovod</span><span class="p">(</span><span class="n">new_horovod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">during_training_metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">during_training_metric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">after_before_training_metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">after_before_training_metric</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">during_training_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control the metric used during training.</span>

<span class="sd">        Metric for evaluated on the validation set during training.</span>
<span class="sd">        Default is &quot;ldos&quot;, meaning that the regular loss on the LDOS will be</span>
<span class="sd">        used as a metric. Possible options are &quot;band_energy&quot; and</span>
<span class="sd">        &quot;total_energy&quot;. For these, the band resp. total energy of the</span>
<span class="sd">        validation snapshots will be calculated and compared to the provided</span>
<span class="sd">        DFT results. Of these, the mean average error in eV/atom will be</span>
<span class="sd">        calculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_during_training_metric</span>

    <span class="nd">@during_training_metric</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">during_training_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;ldos&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;horovod&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Currently, MALA can only operate with the &quot;</span>
                                <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">ldos</span><span class="se">\&quot;</span><span class="s2"> metric for horovod runs.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_during_training_metric</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">after_before_training_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the metric used during training.</span>

<span class="sd">        Metric for evaluated on the validation and test set before and after</span>
<span class="sd">        training. Default is &quot;LDOS&quot;, meaning that the regular loss on the LDOS</span>
<span class="sd">        will be used as a metric. Possible options are &quot;band_energy&quot; and</span>
<span class="sd">        &quot;total_energy&quot;. For these, the band resp. total energy of the</span>
<span class="sd">        validation snapshots will be calculated and compared to the provided</span>
<span class="sd">        DFT results. Of these, the mean average error in eV/atom will be</span>
<span class="sd">        calculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_after_before_training_metric</span>

    <span class="nd">@after_before_training_metric</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">after_before_training_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;ldos&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;horovod&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Currently, MALA can only operate with the &quot;</span>
                                <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">ldos</span><span class="se">\&quot;</span><span class="s2"> metric for horovod runs.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_after_before_training_metric</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@during_training_metric</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">during_training_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;ldos&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;horovod&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Currently, MALA can only operate with the &quot;</span>
                                <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">ldos</span><span class="se">\&quot;</span><span class="s2"> metric for horovod runs.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_during_training_metric</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decide whether CUDA graphs are used during training.</span>

<span class="sd">        Doing so will improve performance, but CUDA graphs are only available</span>
<span class="sd">        from CUDA 11.0 upwards.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_graphs</span>

    <span class="nd">@use_graphs</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">use_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configuration</span><span class="p">[</span><span class="s2">&quot;gpu&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> \
                    <span class="n">torch</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">cuda</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parallel_warn</span><span class="p">(</span><span class="s2">&quot;No CUDA or GPU found, cannot use CUDA graphs.&quot;</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">cuda</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">11.0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot use CUDA graphs with a CUDA&quot;</span>
                                    <span class="s2">&quot; version below 11.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_graphs</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="ParametersHyperparameterOptimization"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersHyperparameterOptimization">[docs]</a><span class="k">class</span> <span class="nc">ParametersHyperparameterOptimization</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hyperparameter optimization parameters.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    direction : string</span>
<span class="sd">        Controls whether to minimize or maximize the loss function.</span>
<span class="sd">        Arguments are &quot;minimize&quot; and &quot;maximize&quot; respectively.</span>

<span class="sd">    n_trials : int</span>
<span class="sd">        Controls how many trials are performed (when using optuna).</span>
<span class="sd">        Default: 100.</span>

<span class="sd">    hlist : list</span>
<span class="sd">        List containing hyperparameters, that are then passed to optuna.</span>
<span class="sd">        Supported options so far include:</span>

<span class="sd">            - learning_rate (float): learning rate of the training algorithm</span>
<span class="sd">            - layer_activation_xxx (categorical): Activation function used for</span>
<span class="sd">              the feed forward network (see Netwok  parameters for supported</span>
<span class="sd">              activation functions). Note that _xxx is only so that optuna</span>
<span class="sd">              will differentiate between variables. No reordering is</span>
<span class="sd">              performed by the; the order depends on the order in the</span>
<span class="sd">              list. _xxx can be essentially anything. Please note further</span>
<span class="sd">              that you need to either only request one acitvation function</span>
<span class="sd">              (for all layers) or one for specifically for each layer.</span>
<span class="sd">            - ff_neurons_layer_xxx(int): Number of neurons per a layer. Note</span>
<span class="sd">              that _xxx is only so that optuna will differentiate between</span>
<span class="sd">              variables. No reordering is performed by MALA; the order</span>
<span class="sd">              depends on the order in the list. _xxx can be essentially</span>
<span class="sd">              anything.</span>

<span class="sd">        Users normally don&#39;t have to fill this list by hand, the hyperparamer</span>
<span class="sd">        optimizer provide interfaces for this task.</span>


<span class="sd">    hyper_opt_method : string</span>
<span class="sd">        Method used for hyperparameter optimization. Currently supported:</span>

<span class="sd">            - &quot;optuna&quot; : Use optuna for the hyperparameter optimization.</span>
<span class="sd">            - &quot;oat&quot; : Use orthogonal array tuning (currently limited to</span>
<span class="sd">              categorical hyperparemeters). Range analysis is</span>
<span class="sd">              currently done by simply choosing the lowest loss.</span>
<span class="sd">            - &quot;naswot&quot; : Using a NAS without training, based on jacobians.</span>

<span class="sd">    checkpoints_each_trial : int</span>
<span class="sd">        If not 0, checkpoint files will be saved after each</span>
<span class="sd">        checkpoints_each_trial trials. Currently, this only works with</span>
<span class="sd">        optuna.</span>

<span class="sd">    checkpoint_name : string</span>
<span class="sd">        Name used for the checkpoints. Using this, multiple runs</span>
<span class="sd">        can be performed in the same directory. Currently. this</span>
<span class="sd">        only works with optuna.</span>

<span class="sd">    study_name : string</span>
<span class="sd">        Name used for this study (in optuna#s storage). Necessary</span>
<span class="sd">        when operating with a RDB storage.</span>

<span class="sd">    rdb_storage : string</span>
<span class="sd">        Adress of the RDB storage to be used by optuna.</span>

<span class="sd">    rdb_storage_heartbeat : int</span>
<span class="sd">        Heartbeat interval for optuna (in seconds). Default is None.</span>
<span class="sd">        If not None and above 0, optuna will record the heartbeat of intervals.</span>
<span class="sd">        If no action on a RUNNING trial is recognized for longer then this</span>
<span class="sd">        interval, then this trial will be moved to FAILED. In distributed</span>
<span class="sd">        training, setting a heartbeat is currently the only way to achieve</span>
<span class="sd">        a precise number of trials:</span>

<span class="sd">        https://github.com/optuna/optuna/issues/1883</span>

<span class="sd">        For optuna versions below 2.8.0, larger heartbeat intervals are</span>
<span class="sd">        detrimental to performance and should be avoided:</span>

<span class="sd">        https://github.com/optuna/optuna/issues/2685</span>

<span class="sd">        For MALA, no evidence for decreased performance using smaller</span>
<span class="sd">        heartbeat values could be found. So if this is used, 1s is a reasonable</span>
<span class="sd">        value.</span>

<span class="sd">    number_training_per_trial : int</span>
<span class="sd">        Number of network trainings performed per trial. Default is 1,</span>
<span class="sd">        but it makes sense to choose a higher number, to exclude networks</span>
<span class="sd">        that performed by chance (good initilization). Naturally this impedes</span>
<span class="sd">        performance.</span>

<span class="sd">    trial_ensemble_evaluation : string</span>
<span class="sd">        Control how multiple trainings performed during a trial are evaluated.</span>
<span class="sd">        By default, simply &quot;mean&quot; is used. For smaller numbers of training</span>
<span class="sd">        per trial it might make sense to use &quot;mean_std&quot;, which means that</span>
<span class="sd">        the mean of all metrics plus the standard deviation is used,</span>
<span class="sd">        as an estimate of the minimal accuracy to be expected. Currently,</span>
<span class="sd">        &quot;mean&quot; and &quot;mean_std&quot; are allowed.</span>

<span class="sd">    use_multivariate : bool</span>
<span class="sd">        If True, the optuna multivariate sampler is used. It is experimental</span>
<span class="sd">        since v2.2.0, but reported to perform very well.</span>
<span class="sd">        http://proceedings.mlr.press/v80/falkner18a.html</span>

<span class="sd">    naswot_pruner_cutoff : float</span>
<span class="sd">        If the surrogate loss algorithm is used as a pruner during a study,</span>
<span class="sd">        this cutoff determines which trials are neglected.</span>

<span class="sd">    pruner: string</span>
<span class="sd">        Pruner type to be used by optuna. Currently supported:</span>

<span class="sd">            - &quot;multi_training&quot;: If multiple trainings are performed per</span>
<span class="sd">              trial, and one returns &quot;inf&quot; for the loss,</span>
<span class="sd">              no further training will be performed.</span>
<span class="sd">              Especially useful if used in conjunction</span>
<span class="sd">              with the band_energy metric.</span>
<span class="sd">            - &quot;naswot&quot;: use the NASWOT algorithm as pruner</span>

<span class="sd">    naswot_pruner_batch_size : int</span>
<span class="sd">        Batch size for the NASWOT pruner</span>

<span class="sd">    number_bad_trials_before_stopping : int</span>
<span class="sd">        Only applies to optuna studies. If any integer above 0, then if no</span>
<span class="sd">        new best trial is found within number_bad_trials_before trials after</span>
<span class="sd">        the last one, the study will be stopped.</span>

<span class="sd">    sqlite_timeout : int</span>
<span class="sd">        Timeout for the SQLite backend of Optuna. This backend is officially</span>
<span class="sd">        not recommended because it is file based and can lead to errors;</span>
<span class="sd">        With a suitable timeout it can be used somewhat stable though and</span>
<span class="sd">        help in HPC settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersHyperparameterOptimization</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;minimize&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_trials</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyper_opt_method</span> <span class="o">=</span> <span class="s2">&quot;optuna&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints_each_trial</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_name</span> <span class="o">=</span> <span class="s2">&quot;checkpoint_mala_ho&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">study_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdb_storage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rdb_storage_heartbeat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_training_per_trial</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_ensemble_evaluation</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_multivariate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">naswot_pruner_cutoff</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pruner</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">naswot_pruner_batch_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_bad_trials_before_stopping</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqlite_timeout</span> <span class="o">=</span> <span class="mi">600</span>

        <span class="c1"># For accelerated hyperparameter optimization.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acsd_points</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rdb_storage_heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Control whether a heartbeat is used for distributed optuna runs.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rdb_storage_heartbeat</span>

    <span class="nd">@rdb_storage_heartbeat</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rdb_storage_heartbeat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rdb_storage_heartbeat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rdb_storage_heartbeat</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">number_training_per_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Control how many trainings are run per optuna trial.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_training_per_trial</span>

    <span class="nd">@number_training_per_trial</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">number_training_per_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_number_training_per_trial</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_number_training_per_trial</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trial_ensemble_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control how multiple trainings performed during a trial are evaluated.</span>

<span class="sd">        By default, simply &quot;mean&quot; is used. For smaller numbers of training</span>
<span class="sd">        per trial it might make sense to use &quot;mean_std&quot;, which means that</span>
<span class="sd">        the mean of all metrics plus the standard deviation is used,</span>
<span class="sd">        as an estimate of the minimal accuracy to be expected. Currently,</span>
<span class="sd">        &quot;mean&quot; and &quot;mean_std&quot; are allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trial_ensemble_evaluation</span>

    <span class="nd">@trial_ensemble_evaluation</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">trial_ensemble_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;mean&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">!=</span> <span class="s2">&quot;mean_std&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trial_ensemble_evaluation</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trial_ensemble_evaluation</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="ParametersHyperparameterOptimization.show"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersHyperparameterOptimization.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print name and values of all attributes of this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        indent : string</span>
<span class="sd">            The indent used in the list with which the parameter</span>
<span class="sd">            shows itself.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="s2">&quot;_configuration&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="s2">&quot;hlist&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                        <span class="n">printout</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)),</span> <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">printout</span><span class="p">(</span>
                            <span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)),</span>
                            <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;hlist&quot;</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">hyp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlist</span><span class="p">:</span>
                        <span class="n">printout</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="s2">&quot;hyperparameter #&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">hyp</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                 <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="ParametersDataGeneration"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.ParametersDataGeneration">[docs]</a><span class="k">class</span> <span class="nc">ParametersDataGeneration</span><span class="p">(</span><span class="n">ParametersBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    All parameters to help with data generation.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    trajectory_analysis_denoising_width : int</span>
<span class="sd">        The distance metric is denoised prior to analysis using a certain</span>
<span class="sd">        width. This should be adjusted if there is reason to believe</span>
<span class="sd">        the trajectory will be noise for some reason.</span>

<span class="sd">    trajectory_analysis_below_average_counter : int</span>
<span class="sd">        Number of time steps that have to consecutively below the average</span>
<span class="sd">        of the distance metric curve, before we consider the trajectory</span>
<span class="sd">        to be equilibrated.</span>
<span class="sd">        Usually does not have to be changed.</span>

<span class="sd">    trajectory_analysis_estimated_equilibrium : float</span>
<span class="sd">        The analysis of the trajectory builds on the assumption that at some</span>
<span class="sd">        point of the trajectory, the system is equilibrated.</span>
<span class="sd">        For this, we need to provide the fraction of the trajectory (counted</span>
<span class="sd">        from the end). Usually, 10% is a fine assumption. This value usually</span>
<span class="sd">        does not need to be changed.</span>

<span class="sd">    local_psp_path : string</span>
<span class="sd">        Path to where the local pseudopotential is stored (for OF-DFT-MD).</span>

<span class="sd">    local_psp_name : string</span>
<span class="sd">        Name of the local pseudopotential (for OF-DFT-MD).</span>

<span class="sd">    ofdft_timestep : int</span>
<span class="sd">        Timestep of the OF-DFT-MD simulation.</span>

<span class="sd">    ofdft_number_of_timesteps : int</span>
<span class="sd">        Number of timesteps for the OF-DFT-MD simulation.</span>

<span class="sd">    ofdft_temperature : float</span>
<span class="sd">        Temperature at which to perform the OF-DFT-MD simulation.</span>

<span class="sd">    ofdft_kedf : string</span>
<span class="sd">        Kinetic energy functional to be used for the OF-DFT-MD simulation.</span>

<span class="sd">    ofdft_friction : float</span>
<span class="sd">        Friction to be added for the Langevin dynamics in the OF-DFT-MD run.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ParametersDataGeneration</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory_analysis_denoising_width</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory_analysis_below_average_counter</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trajectory_analysis_estimated_equilibrium</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_psp_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_psp_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ofdft_timestep</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ofdft_number_of_timesteps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ofdft_temperature</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ofdft_kedf</span> <span class="o">=</span> <span class="s2">&quot;WT&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ofdft_friction</span> <span class="o">=</span> <span class="mf">0.1</span></div>


<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters">[docs]</a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    All parameter MALA needs to perform its various tasks.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    comment : string</span>
<span class="sd">        Characterizes a set of parameters (e.g. &quot;experiment_ddmmyy&quot;).</span>

<span class="sd">    network : ParametersNetwork</span>
<span class="sd">        Contains all parameters necessary for constructing a neural network.</span>

<span class="sd">    descriptors : ParametersDescriptors</span>
<span class="sd">        Contains all parameters necessary for calculating/parsing descriptors.</span>

<span class="sd">    targets : ParametersTargets</span>
<span class="sd">        Contains all parameters necessary for calculating/parsing output</span>
<span class="sd">        quantites.</span>

<span class="sd">    data : ParametersData</span>
<span class="sd">        Contains all parameters necessary for loading and preprocessing data.</span>

<span class="sd">    running : ParametersRunning</span>
<span class="sd">        Contains parameters needed for network runs (train, test or inference).</span>

<span class="sd">    hyperparameters : ParametersHyperparameterOptimization</span>
<span class="sd">        Parameters used for hyperparameter optimization.</span>

<span class="sd">    debug : ParametersDebug</span>
<span class="sd">        Container for all debugging parameters.</span>

<span class="sd">    manual_seed: int</span>
<span class="sd">        If not none, this value is used as manual seed for the neural networks.</span>
<span class="sd">        Can be used to make experiments comparable. Default: None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Parameters subobjects.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">ParametersNetwork</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span> <span class="o">=</span> <span class="n">ParametersDescriptors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">ParametersTargets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ParametersData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="n">ParametersRunning</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span> <span class="o">=</span> <span class="n">ParametersHyperparameterOptimization</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datageneration</span> <span class="o">=</span> <span class="n">ParametersDataGeneration</span><span class="p">()</span>

        <span class="c1"># Attributes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manual_seed</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_configuration</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># TODO: Maybe as a percentage? Feature dimensions can be quite</span>
        <span class="c1"># different.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_granularity</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust the memory overhead of the OpenPMD interface.</span>

<span class="sd">        Smallest possible value is 1, meaning smallest memory footprint</span>
<span class="sd">        and slowest I/O. Higher values will introduce some memory penalty,</span>
<span class="sd">        but offer greater speed.</span>
<span class="sd">        The maximum level is the feature dimension of your data set, if</span>
<span class="sd">        you choose a value larger than this feature dimension, it will</span>
<span class="sd">        automatically be set to the feature dimension upon loading.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_granularity</span>

    <span class="nd">@openpmd_granularity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_granularity</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_update_openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_granularity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">_update_openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_granularity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">_update_openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_granularity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_update_openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_granularity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">_update_openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_granularity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">_update_openpmd_granularity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_granularity</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">verbosity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Control the level of output for MALA.</span>

<span class="sd">        The following options are available:</span>

<span class="sd">            - 0: &quot;low&quot;, only essential output will be printed</span>
<span class="sd">            - 1: &quot;medium&quot;, most diagnostic output will be printed. (Default)</span>
<span class="sd">            - 2: &quot;high&quot;, all information will be printed.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbosity</span>

    <span class="nd">@verbosity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">verbosity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbosity</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">set_current_verbosity</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Control whether or not a GPU is used (provided there is one).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_gpu</span>

    <span class="nd">@use_gpu</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">use_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_use_gpu</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parallel_warn</span><span class="p">(</span><span class="s2">&quot;GPU requested, but no GPU found. MALA will &quot;</span>
                              <span class="s2">&quot;operate with CPU only.&quot;</span><span class="p">)</span>

        <span class="c1"># Invalidate, will be updated in setter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_update_gpu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">_update_gpu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">_update_gpu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_update_gpu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">_update_gpu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">_update_gpu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_horovod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Control whether or not horovod is used for parallel training.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_horovod</span>

    <span class="nd">@use_horovod</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">use_horovod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">hvd</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

        <span class="c1"># Invalidate, will be updated in setter.</span>
        <span class="n">set_horovod_status</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_horovod</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_update_horovod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">_update_horovod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">_update_horovod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_update_horovod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">_update_horovod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">_update_horovod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_horovod</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the device used by MALA. Read-only.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_device</span>

    <span class="nd">@device</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">get_local_rank</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="s2">&quot;cuda:&quot;</span>\
                           <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_mpi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Control whether or not horovod is used for parallel training.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_mpi</span>

    <span class="nd">@use_mpi</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">use_mpi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">set_mpi_status</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># Invalidate, will be updated in setter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_mpi</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_update_mpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">_update_mpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">_update_mpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_update_mpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">_update_mpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">_update_mpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide a .toml or .json formatted string to configure OpenPMD.</span>

<span class="sd">        To load a configuration from a file, add an &quot;@&quot; in front of the file</span>
<span class="sd">        name and put the resulting string here. OpenPMD will then load</span>
<span class="sd">        the file. For further details, see the OpenPMD documentation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_configuration</span>

    <span class="nd">@openpmd_configuration</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_openpmd_configuration</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Invalidate, will be updated in setter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_update_openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpmd_configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">_update_openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpmd_configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">_update_openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpmd_configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_update_openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpmd_configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">_update_openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpmd_configuration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">_update_openpmd_configuration</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openpmd_configuration</span><span class="p">)</span>

<div class="viewcode-block" id="Parameters.show"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print name and values of all attributes of this object.&quot;&quot;&quot;</span>
        <span class="n">printout</span><span class="p">(</span><span class="s2">&quot;--- &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ---&quot;</span><span class="p">,</span>
                 <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Two for-statements so that global parameters are shown on top.</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">ParametersBase</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                    <span class="n">printout</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)),</span>
                             <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">printout</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%-15s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)),</span>
                             <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">ParametersBase</span><span class="p">):</span>
                <span class="n">parobject</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">printout</span><span class="p">(</span><span class="s2">&quot;--- &quot;</span> <span class="o">+</span> <span class="n">parobject</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; ---&quot;</span><span class="p">,</span>
                         <span class="n">min_verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">parobject</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.save"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the Parameters object to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            File to which the parameters will be saved to.</span>

<span class="sd">        save_format : string</span>
<span class="sd">            File format which is used for parameter saving.</span>
<span class="sd">            Currently only supported file format is &quot;pickle&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">get_rank</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">save_format</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">!=</span> <span class="s2">&quot;pkl&quot;</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.pkl&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">!=</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;.json&quot;</span>
            <span class="n">json_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="ow">not</span> <span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">isroutine</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>

            <span class="c1"># Two for loops so global properties enter the dict first.</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="c1"># Filter out all private members, builtins, etc.</span>
                <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span> <span class="ow">and</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ParametersBase</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">json_dict</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                <span class="c1"># Filter out all private members, builtins, etc.</span>
                <span class="k">if</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ParametersBase</span><span class="p">):</span>
                        <span class="c1"># All the subclasses have to provide this function.</span>
                        <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">ParametersBase</span>
                        <span class="n">json_dict</span><span class="p">[</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported parameter save format.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.save_as_pickle"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters.save_as_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">save_as_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the Parameters object to a pickle file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            File to which the parameters will be saved to.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s2">&quot;pickle&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.save_as_json"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters.save_as_json">[docs]</a>    <span class="k">def</span> <span class="nf">save_as_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the Parameters object to a json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            File to which the parameters will be saved to.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.optuna_singlenode_setup"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters.optuna_singlenode_setup">[docs]</a>    <span class="k">def</span> <span class="nf">optuna_singlenode_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wait_time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up device and parallelization parameters for Optuna+MPI.</span>

<span class="sd">        This only needs to be called if multiple MPI ranks are used on</span>
<span class="sd">        one node to run Optuna. Optuna itself does NOT communicate via MPI.</span>
<span class="sd">        Thus, if we allocate e.g. one node with 4 GPUs and start 4 jobs,</span>
<span class="sd">        3 of those jobs will fail, because currently, we instantiate the</span>
<span class="sd">        cuda devices based on MPI ranks. This functions sets everything</span>
<span class="sd">        up properly. This of course requires MPI.</span>
<span class="sd">        This may be a bit hacky, but it lets us use one script and one</span>
<span class="sd">        MPI command to launch x GPU backed jobs on any node with x GPUs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wait_time : int</span>
<span class="sd">            If larger than 0, then all processes will wait this many seconds</span>
<span class="sd">            times their rank number after this routine before proceeding.</span>
<span class="sd">            This can be useful when using a file based distribution algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We first &quot;trick&quot; the parameters object to assume MPI and GPUs</span>
        <span class="c1"># are used. That way we get the right device.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">device_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="n">sleep</span><span class="p">(</span><span class="n">get_rank</span><span class="p">()</span><span class="o">*</span><span class="n">wait_time</span><span class="p">)</span>

        <span class="c1"># Now we can turn of MPI and set the device manually.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_mpi</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">device_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="n">device_temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="n">device_temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="n">device_temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="n">device_temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="n">device_temp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">_update_device</span><span class="p">(</span><span class="n">device_temp</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.load_from_file"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters.load_from_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
                       <span class="n">no_snapshots</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a Parameters object from a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : string or ZipExtFile</span>
<span class="sd">            File to which the parameters will be saved to.</span>

<span class="sd">        save_format : string</span>
<span class="sd">            File format which is used for parameter saving.</span>
<span class="sd">            Currently only supported file format is &quot;pickle&quot;.</span>

<span class="sd">        no_snapshots : bool</span>
<span class="sd">            If True, than the snapshot list will be emptied. Useful when</span>
<span class="sd">            performing inference/testing after training a network.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loaded_parameters : Parameters</span>
<span class="sd">            The loaded Parameters object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">save_format</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">loaded_parameters</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">loaded_parameters</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">no_snapshots</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">loaded_parameters</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">snapshot_directories_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">save_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">json_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">json_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

            <span class="n">loaded_parameters</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> \
                        <span class="o">!=</span> <span class="s2">&quot;openpmd_configuration&quot;</span><span class="p">:</span>
                    <span class="c1"># These are the other parameter classes.</span>
                    <span class="n">sub_parameters</span> <span class="o">=</span>\
                        <span class="nb">globals</span><span class="p">()[</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;_parameters_type&quot;</span><span class="p">]]</span><span class="o">.</span>\
                        <span class="n">from_json</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">loaded_parameters</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">sub_parameters</span><span class="p">)</span>

            <span class="c1"># We iterate a second time, to set global values, so that they</span>
            <span class="c1"># are properly forwarded.</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> \
                        <span class="s2">&quot;openpmd_configuration&quot;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">loaded_parameters</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">no_snapshots</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">loaded_parameters</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">snapshot_directories_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported parameter save format.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loaded_parameters</span></div>

<div class="viewcode-block" id="Parameters.load_from_pickle"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters.load_from_pickle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_pickle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">no_snapshots</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a Parameters object from a pickle file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : string or ZipExtFile</span>
<span class="sd">            File to which the parameters will be saved to.</span>

<span class="sd">        no_snapshots : bool</span>
<span class="sd">            If True, than the snapshot list will be emptied. Useful when</span>
<span class="sd">            performing inference/testing after training a network.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loaded_parameters : Parameters</span>
<span class="sd">            The loaded Parameters object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Parameters</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s2">&quot;pickle&quot;</span><span class="p">,</span>
                                         <span class="n">no_snapshots</span><span class="o">=</span><span class="n">no_snapshots</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.load_from_json"><a class="viewcode-back" href="../../../api/mala.common.parameters.html#mala.common.parameters.Parameters.load_from_json">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">no_snapshots</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a Parameters object from a json file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : string or ZipExtFile</span>
<span class="sd">            File to which the parameters will be saved to.</span>

<span class="sd">        no_snapshots : bool</span>
<span class="sd">            If True, than the snapshot list will be emptied. Useful when</span>
<span class="sd">            performing inference/testing after training a network.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loaded_parameters : Parameters</span>
<span class="sd">            The loaded Parameters object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Parameters</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
                                         <span class="n">no_snapshots</span><span class="o">=</span><span class="n">no_snapshots</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software. Attila Cangi, J. Austin Ellis, Lenz Fiedler, Daniel Kotik, Normand Modine, Sivasankaran Rajamanickam, Steve Schmerler, Aidan Thompson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>