<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Training a model &mdash; Materials Learning Algorithms (MALA)  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/mala_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Postprocessing the LDOS" href="postprocessing.html" />
    <link rel="prev" title="Data generation and preprocessing" href="preprocessing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/mala_horizontal_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../usage.html">Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basicconcepts.html">Basic concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocessing.html">Data generation and preprocessing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Training a model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#optimal-performance">Optimal performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html">Postprocessing the LDOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperparameters.html">Tuning the hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="predictions.html">Predict electronic structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="production.html">MALA production inference runs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTE.html">Contributing to MALA</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Materials Learning Algorithms (MALA)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../usage.html">Usage</a> &raquo;</li>
      <li>Training a model</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//mala-project/mala/blob/develop/docs/source/usage/trainingmodel.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="training-a-model">
<h1>Training a model<a class="headerlink" href="#training-a-model" title="Permalink to this headline"></a></h1>
<p>Neural networks are powerful machine learning tools in principle capable of
approximating any function. In MALA, neural networks are built using PyTorch.
Hyperparameter optimization can be done using optuna and custom routines.
To see how a model is trained, refer to e.g. <code class="docutils literal notranslate"><span class="pre">ex01_singleshot</span></code>.</p>
<div class="section" id="optimal-performance">
<h2>Optimal performance<a class="headerlink" href="#optimal-performance" title="Permalink to this headline"></a></h2>
<p>MALA by default uses sub-optimal training parameters to guarantee compatibility
with a wide range of systems. Users are encouraged to activate advanced
features for optimal performance. The following is a list of parameters that
can and should be looked into.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This setting is pretty straightforward - wherever possible, use a GPU.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># True: Use GPU</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Multiple workers allow for faster data processing, but require</span>
<span class="sd">additional CPU/RAM power. A good setup is e.g. using 4 CPUs attached</span>
<span class="sd">to one GPU and setting the num_workers to 4.</span>
<span class="sd">Please be aware that using multiple workers is currently not supported</span>
<span class="sd">with horovod.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># set to e.g. 4</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">MALA supports a faster implementation of the TensorDataSet class</span>
<span class="sd">from the torch library. Turning it on will drastically improve</span>
<span class="sd">performance.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">use_fast_tensor_data_set</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># True: Faster data loading</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Likewise, using CUDA graphs improve performance by optimizing GPU</span>
<span class="sd">usage. Be careful, this option is only availabe from CUDA 11.0 onwards.</span>
<span class="sd">CUDA graphs will be most effective in cases that are latency-limited,</span>
<span class="sd">e.g. small models with shorter epoch times.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">use_graphs</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># True: Better GPU utilization</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Using mixed precision can also improve performance, but only if</span>
<span class="sd">the model is large enough.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">use_mixed_precision</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># True: Improved performance for large models</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="preprocessing.html" class="btn btn-neutral float-left" title="Data generation and preprocessing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="postprocessing.html" class="btn btn-neutral float-right" title="Postprocessing the LDOS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software. Attila Cangi, J. Austin Ellis, Lenz Fiedler, Daniel Kotik, Normand Modine, Sivasankaran Rajamanickam, Steve Schmerler, Aidan Thompson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>