<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data generation and preprocessing &mdash; Materials Learning Algorithms (MALA)  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/mala_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Training a model" href="trainingmodel.html" />
    <link rel="prev" title="Basic concepts" href="basicconcepts.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/mala_horizontal_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../usage.html">Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basicconcepts.html">Basic concepts</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Data generation and preprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-generation">Data generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-conversion">Data Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-input-and-output-data">Using input and output data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#descriptors">Descriptors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#targets">Targets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#data-scaling">Data Scaling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="trainingmodel.html">Training a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="postprocessing.html">Postprocessing the LDOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperparameters.html">Tuning the hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="predictions.html">Predict electronic structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="production.html">MALA production runs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTE.html">Contributing to MALA</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Materials Learning Algorithms (MALA)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../usage.html">Usage</a> &raquo;</li>
      <li>Data generation and preprocessing</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//mala-project/mala/blob/develop/docs/source/usage/preprocessing.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="data-generation-and-preprocessing">
<h1>Data generation and preprocessing<a class="headerlink" href="#data-generation-and-preprocessing" title="Permalink to this headline"></a></h1>
<div class="section" id="data-generation">
<h2>Data generation<a class="headerlink" href="#data-generation" title="Permalink to this headline"></a></h2>
<p>Data generation for MALA is done by electronic structure calculations using
appropriate simulation software. The raw outputs of such calculations
are atomic positions and the LDOS, the latter usually as multiple individual
.cube files.</p>
<p>Currently, only QuantumESPRESSO has been tested. Starting with version 7.2,
any version of QuantumESPRESSO can be used to create data for MALA. In order
to do so</p>
<ol class="arabic simple">
<li><p>Perform a regular DFT calculation using <code class="docutils literal notranslate"><span class="pre">pw.x</span></code></p></li>
<li><p>Calculate the LDOS using <code class="docutils literal notranslate"><span class="pre">pp.x</span></code></p></li>
</ol>
<p>Make sure to use enough k-points in the DFT calculation (LDOS sampling
requires denser k-grids then regular DFT calculations) and an appropriate
energy grid when calculating the LDOS. See the
<a class="reference internal" href="../about/publications.html"><span class="doc">MALA publications</span></a> for
examples of such values for other materials. Lastly, when calculating
the LDOS with <code class="docutils literal notranslate"><span class="pre">pp.x</span></code>, make sure to set <code class="docutils literal notranslate"><span class="pre">use_gauss_ldos=.true.</span></code> in the
<code class="docutils literal notranslate"><span class="pre">inputpp</span></code> section.</p>
</div>
<div class="section" id="data-conversion">
<h2>Data Conversion<a class="headerlink" href="#data-conversion" title="Permalink to this headline"></a></h2>
<p>MALA can be used to process raw data into ready-to-use data fro the surrogate models
For this, the <code class="docutils literal notranslate"><span class="pre">DataConverter</span></code> class can be used; see example <code class="docutils literal notranslate"><span class="pre">ex02_preprocess_data</span></code>.
If you are not sure which descriptor hyperparameters to use (e.g.: “Which cutoff
radius do I need?”) MALA provides a fast analysis that does not involve
model tuning. See <code class="docutils literal notranslate"><span class="pre">ex13_acsd</span></code>.</p>
<p>By default, MALA saves its data files to numpy <code class="docutils literal notranslate"><span class="pre">.npy</span></code> files. However, for
storing large amounts of volumetric data (plus metadata), libraries such as
<a class="reference external" href="https://github.com/openPMD/openPMD-api">OpenPMD</a> are more suitable.
MALA provides a full OpenPMD interface that is currently tested in production.
We recommend usage of the OpenPMD interface, which will become the new default
in upcoming versions. Examples related to data processing and general workflow
usage include lines that showcase the usage of OpenPMD within MALA.</p>
</div>
<div class="section" id="using-input-and-output-data">
<h2>Using input and output data<a class="headerlink" href="#using-input-and-output-data" title="Permalink to this headline"></a></h2>
<p>MALA divides provided data into two categories: <code class="docutils literal notranslate"><span class="pre">Descriptor</span></code> objects
and <code class="docutils literal notranslate"><span class="pre">Target</span></code> objects.</p>
<div class="section" id="descriptors">
<h3>Descriptors<a class="headerlink" href="#descriptors" title="Permalink to this headline"></a></h3>
<p>Descriptors give, per grid-point, information about the
local environment around that grid-point. In most cases, users will not have
to interact with a <code class="docutils literal notranslate"><span class="pre">Descriptor</span></code> object. Yet, these objects can be created
by themselves if needed. The default option for descriptor calculation
is <code class="docutils literal notranslate"><span class="pre">Bispectrum</span></code>, i.e., the bispectrum descriptors used in all current MALA
publications. Experimental options include <code class="docutils literal notranslate"><span class="pre">AtomicDensity</span></code> (i.e. the raw
atomic density, e.g. for convolutional approaches) and <code class="docutils literal notranslate"><span class="pre">MinterpyDescriptors</span></code>
(currently experimental).</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mala</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">descriptors</span><span class="o">.</span><span class="n">descriptor_type</span> <span class="o">=</span> <span class="s1">&#39;Bispectrum&#39;</span>

<span class="c1"># Creates a bispectrum object via interface</span>
<span class="n">bispectrum</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">Descriptor</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

<span class="c1"># Creates a bispectrum object directly</span>
<span class="n">bispectrum</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">Bispectrum</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

<span class="c1"># Use the bispectrum object to calculate descriptors from QE calculation.</span>
<span class="n">bispectrum_descriptors</span> <span class="o">=</span> <span class="n">bispectrum</span><span class="o">.</span><span class="n">calculate_from_qe_out</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="targets">
<h3>Targets<a class="headerlink" href="#targets" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Target</span></code> objects hold information about the electronic structure of a material.
In comparison to the <code class="docutils literal notranslate"><span class="pre">Descriptor</span></code> objects these objects are more common
in workflows, as they can be used for a variety of physical calculations.
They can also be used to parse data from ab-initio simulations
E.g. in a script like this:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mala</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
<span class="n">parameters</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">descriptor_type</span> <span class="o">=</span> <span class="s1">&#39;LDOS&#39;</span>

<span class="c1"># Creates a LDOS object via interface</span>
<span class="n">ldos</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">Target</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

<span class="c1"># Creates a LDOS object directly</span>
<span class="n">ldos</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">LDOS</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

<span class="c1"># Use the LDOS object to calculate the band energy from LDOS data.</span>
<span class="n">ldos_data</span> <span class="o">=</span> <span class="n">ldos</span><span class="o">.</span><span class="n">read_from_cube</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">band_energy</span> <span class="o">=</span> <span class="n">ldos</span><span class="o">.</span><span class="n">get_band_energy</span><span class="p">(</span><span class="n">ldos_data</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="data-scaling">
<h2>Data Scaling<a class="headerlink" href="#data-scaling" title="Permalink to this headline"></a></h2>
<p>An additional step of preprocessing is scaling the data before a model is
trained. This is done automatically in the <code class="docutils literal notranslate"><span class="pre">DataHandler</span></code> class, using the
methods requested via the <code class="docutils literal notranslate"><span class="pre">mala.parameters.data.input_rescaling_type</span></code> and
<code class="docutils literal notranslate"><span class="pre">mala.parameters.data.output_rescaling_type</span></code> keywords. Currently supported here
are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code>: No normalization is applied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standard</span></code>: Standardization (Scale to mean 0, standard deviation 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">normal</span></code>: Min-Max scaling (Scale to be in range 0…1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feature-wise-standard</span></code>: Row Standardization (Scale to mean 0, standard deviation 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">feature-wise-normal</span></code>: Row Min-Max scaling (Scale to be in range 0…1)</p></li>
</ul>
<p>Internally, the <code class="docutils literal notranslate"><span class="pre">DataScaler</span></code> class is used. The objects of this class
can be saved and loaded later for e.g. inference or to minimize calculation
time for multiple ML experiments using the same set of data.
Data scaling will always be done using the training data only.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="basicconcepts.html" class="btn btn-neutral float-left" title="Basic concepts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="trainingmodel.html" class="btn btn-neutral float-right" title="Training a model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software. Attila Cangi, J. Austin Ellis, Lenz Fiedler, Daniel Kotik, Normand Modine, Sivasankaran Rajamanickam, Steve Schmerler, Aidan Thompson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>